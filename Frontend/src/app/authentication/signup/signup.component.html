<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card my-5">
                <div class="card-header text-center">
                    <h3>Register to <span class="fw-bold text-primary">Kitaab Ghar</span></h3>
                </div>
                <div class="card-body">
                    <form [formGroup]="registrationForm" (ngSubmit)="register()">
                        <!-- full name -->
                        <div class="form-group mb-3">
                            <label for="full-name" class="form-label">Full Name<span
                                    *ngIf="registrationForm.get('full_name')?.errors?.['required']"
                                    class="text-danger fw-bold">*</span> : </label>
                            <input type="text" id="full-name" class="form-control" formControlName="full_name"
                                [ngClass]="{'is-invalid':registrationForm.get('full_name')?.invalid&& (registrationForm.get('full_name')?.touched||registrationForm.get('full_name')?.dirty),'is-valid':registrationForm.get('full_name')?.valid}">
                            <small
                                *ngIf="registrationForm.get('full_name')?.touched && registrationForm.get('full_name')?.errors?.['required']"
                                class="text-danger">
                                *required
                            </small>
                            <small *ngIf="registrationForm.get('full_name')?.errors?.['pattern']" class="text-danger">
                                Please enter a valid full name using letters only. Numbers and special characters are
                                not allowed.
                            </small>
                        </div>

                        <!-- user name -->
                        <div class="form-group mb-3">
                            <label for="user-name" class="form-label">User Name<span
                                    *ngIf="registrationForm.get('user_name')?.errors?.['required']"
                                    class="text-danger fw-bold">*</span> : </label>
                            <input type="text" id="user-name" class="form-control" formControlName="user_name"
                                [ngClass]="{'is-invalid':registrationForm.get('user_name')?.invalid&& (registrationForm.get('user_name')?.touched||registrationForm.get('user_name')?.dirty),'is-valid':registrationForm.get('user_name')?.valid}">
                            <small
                                *ngIf="registrationForm.get('user_name')?.touched && registrationForm.get('user_name')?.errors?.['required']"
                                class="text-danger">
                                *required
                            </small>
                            <small *ngIf="registrationForm.get('user_name')?.errors?.['pattern']" class="text-danger">
                                Please enter a valid username. It should only contain lowercase letters, numbers, and
                                underscores, with no spaces or
                                capital letters.
                            </small>
                        </div>

                        <!-- role -->
                        <div class="form-group mb-3">
                            <label for="role-select" class="form-label">Role
                                <span *ngIf="registrationForm.get('role')?.errors?.['required']"
                                    class="text-danger fw-bold">*</span> :
                            </label>
                            <select class="form-select" id="role-select" formControlName="role" [ngClass]="{
                'is-invalid': registrationForm.get('role')?.invalid && 
                              (registrationForm.get('role')?.touched || 
                               registrationForm.get('role')?.dirty),
                'is-valid': registrationForm.get('role')?.valid
            }">
                                <option disabled selected>Select Role</option>
                                <option value="User">User</option>
                                <option value="Admin">Admin</option>
                            </select>
                            <small
                                *ngIf="registrationForm.get('role')?.touched && registrationForm.get('role')?.errors?.['required']"
                                class="text-danger">*required</small>
                        </div>

                        <!-- gender -->
                        <div class="mb-3">
                            <label class="form-label ms-1 me-3">Gender<span
                                    *ngIf="registrationForm.get('gender')?.errors?.['required']"
                                    class="text-danger fw-bold">*</span> : </label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="gender" id="male" value="Male"
                                    formControlName="gender">
                                <label class="form-check-label" for="male">Male</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="gender" id="female" value="Female"
                                    formControlName="gender">
                                <label class="form-check-label" for="female">Female</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="gender" id="other" value="Other"
                                    formControlName="gender">
                                <label class="form-check-label" for="other">Other</label>
                            </div>
                        </div>

                        <!-- hobbies -->
                        <div class="mb-3" formArrayName="hobbies">
                            <label class="form-label ms-1 me-3">Hobbies<span
                                    *ngIf="registrationForm.get('hobbies')?.errors?.['required']"
                                    class="text-danger fw-bold">*</span> : </label>
                            <div *ngFor="let hobby of hobbiesList; let i = index" class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" [id]="'hobby' + i" [value]="hobby"
                                    (change)="onHobbyChange($event)">
                                <label class="form-check-label" [for]="'hobby' + i">{{ hobby }}</label>
                            </div>
                        </div>

                        <!-- date of birth -->
                        <div class="form-group mb-3">
                            <label for="dob" class="form-label">Date of birth<span
                                    *ngIf="registrationForm.get('dob')?.errors?.['required']"
                                    class="text-danger fw-bold">*</span> : </label>
                            <input type="date" class="form-control" id="dob" formControlName="dob"
                                [ngClass]="{'is-invalid':registrationForm.get('dob')?.invalid&& (registrationForm.get('dob')?.touched||registrationForm.get('dob')?.dirty),'is-valid':registrationForm.get('dob')?.valid}">
                            <small
                                *ngIf="registrationForm.get('dob')?.touched && registrationForm.get('dob')?.errors?.['required']"
                                class="text-danger">
                                *required
                            </small>
                            <small *ngIf="registrationForm.get('dob')?.errors?.['underage']" class="text-danger">
                                Age must be at least 18 years old
                            </small>
                        </div>

                        <!-- email -->
                        <div class="form-group mb-3">
                            <label for="email" class="form-label">Email<span
                                    *ngIf="registrationForm.get('email')?.errors?.['required']"
                                    class="text-danger fw-bold">*</span> : </label>
                            <input type="email" class="form-control" id="email" formControlName="email"
                                [ngClass]="{'is-invalid':registrationForm.get('email')?.invalid&& (registrationForm.get('email')?.touched||registrationForm.get('email')?.dirty),'is-valid':registrationForm.get('email')?.valid}">
                            <small
                                *ngIf="registrationForm.get('email')?.touched && registrationForm.get('email')?.errors?.['required']"
                                class="text-danger">
                                *required
                            </small>
                            <small *ngIf="registrationForm.get('email')?.errors?.['pattern']" class="text-danger">
                                Please enter a valid email address.
                            </small>
                        </div>

                        <!-- addresses -->
                        <div formArrayName="addresses" >
                            <div *ngFor="let add of addressList.controls; let i = index">
                                <div [formGroupName]="i">
                                    <label class="form-label">Address {{i + 1}} : </label>
                                    <div class="mb-3 form-control">
                                        <!-- street -->
                                        <div class="m-3">
                                            <label for="street" class="form-label">Street<span
                                                    *ngIf="hasError(i, 'street', 'required')"
                                                    class="text-danger fw-bold">*</span>
                                                :
                                            </label>
                                            <textarea id="street" formControlName="street"
                                                class="form-control"></textarea>
                                        </div>
                                        <div class="row m-3 p-0">
                                            <!-- city -->
                                            <div class="mb-2 ps-0 col-4">
                                                <label for="city" class="form-label">City<span
                                                        *ngIf="hasError(i, 'city', 'required')"
                                                        class="text-danger fw-bold">*</span>
                                                    :
                                                </label>
                                                <input type="text" id="city" formControlName="city"
                                                    class="form-control" />
                                            </div>
                                            <!-- state -->
                                            <div class=" mb-2 col-4">
                                                <label for="state" class="form-label">State<span
                                                        *ngIf="hasError(i, 'state', 'required')"
                                                        class="text-danger fw-bold">*</span>
                                                    :
                                                </label>
                                                <input type="text" id="state" formControlName="state"
                                                    class="form-control" />
                                            </div>
                                            <!-- zipCode -->
                                            <div class=" mb-2 pe-0 col-4">
                                                <label for="zip_code" class="form-label">Zipcode<span
                                                        *ngIf="hasError(i, 'zipCode', 'required')"
                                                        class="text-danger fw-bold">*</span>
                                                    :
                                                </label>
                                                <input type="text" id="zip_code" formControlName="zipCode"
                                                    class="form-control" />
                                            </div>
                                        </div>
                                        <!-- remove button -->
                                        <div class="d-flex justify-content-end pe-3 pb-3">
                                            <button *ngIf="i > 0" type="button" class="btn btn-outline-danger"
                                                (click)="removeAddress(i)">Remove</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- add more -->
                            <div class="d-flex justify-content-end pe-3 pb-3">
                                <button class="btn btn-primary" (click)="addAddress()"
                                    [disabled]="!registrationForm.controls['addresses'].valid">Add
                                    Another</button>
                            </div>
                        </div>

                        <!-- mobile no -->
                        <div class="form-group mb-3" formArrayName="mobile_no">
                            <div *ngFor="let mo of mobileNumbers.controls; let i = index" class="mb-3">
                                <label for="mobile" class="form-label">Mobile No {{i + 1}}<span
                                        *ngIf="mobileNumbers.controls[i].errors?.['required']"
                                        class="text-danger fw-bold">*</span> :
                                </label>
                                <div class="d-flex justify-content-between">
                                    <input type="text" class="form-control" id="mobile" [formControlName]="i" [ngClass]="{
                    'is-invalid': mobileNumbers.controls[i].invalid && 
                                  (mobileNumbers.controls[i].touched || 
                                   mobileNumbers.controls[i].dirty),
                    'is-valid': mobileNumbers.controls[i].valid
                }">
                                    <button type="button" *ngIf="i > 0" class="btn btn-sm btn-outline-danger"
                                        (click)="removeMobileNo(i)">Remove</button>
                                </div>
                                <small
                                    *ngIf="mobileNumbers.controls[i].touched && mobileNumbers.controls[i].errors?.['required']"
                                    class="text-danger">
                                    *required
                                </small>
                                <small *ngIf="mobileNumbers.controls[i].errors?.['pattern']" class="text-danger">
                                    Please enter a valid 10-digit mobile number
                                </small>
                            </div>
                            <button class="btn btn-sm btn-primary" (click)="addMobileNo()">Add Mobile No.</button>
                        </div>

                        <!-- password -->
                        <div class="form-group mb-3">
                            <label for="password" class="form-label">Password<span
                                    *ngIf="registrationForm.get('password')?.errors?.['required']"
                                    class="text-danger fw-bold">*</span> : </label>
                            <input type="password" class="form-control" id="password" formControlName="password"
                                [ngClass]="{'is-invalid':registrationForm.get('password')?.invalid&& (registrationForm.get('password')?.touched||registrationForm.get('password')?.dirty),'is-valid':registrationForm.get('password')?.valid}">
                            <small
                                *ngIf="registrationForm.get('password')?.touched && registrationForm.get('password')?.errors?.['required']"
                                class="text-danger">
                                *required
                            </small>
                            <small *ngIf="registrationForm.get('password')?.errors?.['minlength']" class="text-danger">
                                Password must be at least 8 characters long
                            </small>
                            <small *ngIf="registrationForm.get('password')?.errors?.['pattern']" class="text-danger">
                                Password must contain at least one alphabet, one number, and one special character
                            </small>
                        </div>

                        <!-- confirm password -->
                        <div class="form-group mb-3">
                            <label for="cPassword" class="form-label">Confirm Password<span
                                    *ngIf="registrationForm.get('cPassword')?.errors?.['required']"
                                    class="text-danger fw-bold">*</span> :
                            </label>
                            <input type="password" class="form-control" id="cPassword" formControlName="cPassword"
                                [ngClass]="{
                'is-invalid': registrationForm.get('cPassword')?.invalid && 
                              (registrationForm.get('cPassword')?.touched || 
                               registrationForm.get('cPassword')?.dirty) || 
                              (registrationForm.errors?.['passwordMismatch'] && 
                               registrationForm.get('cPassword')?.touched),
                'is-valid': registrationForm.get('cPassword')?.valid && 
                            !registrationForm.errors?.['passwordMismatch']
            }">
                            <small
                                *ngIf="registrationForm.get('cPassword')?.touched && registrationForm.get('cPassword')?.errors?.['required']"
                                class="text-danger">
                                *required
                            </small>
                            <small
                                *ngIf="registrationForm.get('cPassword')?.touched && registrationForm.errors?.['passwordMismatch']"
                                class="text-danger">
                                Passwords do not match
                            </small>
                        </div>

                        <!-- profile pic -->
                        <div class="form-group mb-3">
                            <label for="profilePicture" class="form-label">Profile Picture : </label>
                            <input type="file" class="form-control" id="profilePicture" formControlName="profile_pic"
                                (change)="onFileSelected($event)">
                        </div>

                        <div *ngIf="registrationForm.invalid" class="text-center mb-3">
                            <small class="text-secondary">
                                <span class="text-danger fw-bold">*</span> indicates required fields.
                            </small>
                        </div>

                        <!-- submit button -->
                        <button type="submit" class="btn btn-primary btn-block container"
                            [disabled]="!registrationForm.valid">Register</button>
                    </form>
                </div>
                <div class="card-footer text-center">
                    <small class="text-muted">Already have an account? <a routerLink="/auth/login">Log in</a></small>
                </div>
            </div>
        </div>
    </div>
</div>